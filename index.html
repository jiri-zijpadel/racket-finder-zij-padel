<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Racket Finder ‚Äì ≈Ωij padel</title>

  <style>
    :root{--zp-navy:#003d79;--zp-lime:#c6e801;--zp-text:#1e1e1e;--zp-muted:#f6f8fb;--zp-border:rgba(0,61,121,.16);}
    #zp-quiz{font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:880px;margin:0 auto;padding:20px;color:var(--zp-text);}
    .zp-quiz__card{background:#fff;border:1px solid var(--zp-border);border-radius:16px;box-shadow:0 6px 22px rgba(0,0,0,.06);overflow:hidden;}
    .zp-quiz__title{font-size:26px;font-weight:800;color:var(--zp-navy);text-align:center;margin:20px 0 10px;}
    .zp-quiz__subtitle{text-align:center;color:#444;font-size:15px;margin:0 0 18px;}
    .zp-quiz__progressbar{height:8px;background:var(--zp-muted);border-radius:999px;overflow:hidden;}
    .zp-quiz__progressbar>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--zp-lime),#d9ff4a);transition:width .3s ease;}
    .zp-quiz__progress{padding:0 20px 8px;}
    .zp-quiz__progress-label{font-size:13px;color:#5a5a5a;margin-top:8px;text-align:right;}
    .zp-quiz__body{padding:20px;}

    .zp-step{display:none;} .zp-step.active{display:block;}
    .zp-step h3{font-size:20px;color:var(--zp-navy);margin:0 0 14px;line-height:1.3;}

    .zp-options{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
    @media (max-width:860px){.zp-options{grid-template-columns:repeat(2,1fr);}}
    @media (max-width:520px){.zp-options{grid-template-columns:1fr;}}

    .zp-option{border:1px solid var(--zp-border);border-radius:12px;padding:14px;background:#fff;cursor:pointer;transition:transform .15s ease,box-shadow .2s ease,border-color .2s ease;user-select:none;min-height:64px;display:flex;align-items:center;justify-content:space-between;gap:10px;}
    .zp-option:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(0,0,0,.06);}
    .zp-option.selected{border-color:var(--zp-lime);box-shadow:0 4px 18px rgba(198,232,1,.22);}
    .zp-option__label{font-size:15px;font-weight:700;}
    .zp-option__dot{width:18px;height:18px;border-radius:50%;border:2px solid var(--zp-border);position:relative;flex:0 0 auto;}
    .zp-option.selected .zp-option__dot{border-color:var(--zp-lime);}
    .zp-option.selected .zp-option__dot::after{content:'';position:absolute;inset:3px;border-radius:50%;background:var(--zp-lime);}

    .zp-quiz__nav{display:flex;justify-content:space-between;gap:12px;margin-top:18px;}
    .zp-btn{appearance:none;border:0;cursor:pointer;border-radius:10px;padding:12px 16px;font-weight:800;font-size:15px;display:inline-flex;align-items:center;gap:8px;}
    .zp-btn--primary{background:var(--zp-lime);color: var(--zp-navy);box-shadow:0 6px 16px rgba(198,232,1,.35);}
    .zp-btn--ghost{background:#fff;color:var(--zp-navy);border:1px solid var(--zp-border);}
    .zp-btn[disabled]{opacity:.55;cursor:not-allowed;}
    /* obal odkazu ‚Äì nese animaci */
    .zp-tip-link{display:block;animation:zpTipPulse 3.2s ease-in-out infinite}
    .zp-tip-link:hover{animation:none}

    /* samotn√© tlaƒç√≠tko ‚Äì fixn√≠ barvy */
    .zp-tip-link .zp-btn{background:var(--zp-navy);color:var(--zp-lime);gap:10px}

    /* jemn√° pulzn√≠ animace (bez zmƒõny barev) */
    @keyframes zpTipPulse{
      0%{transform:scale(1);filter:drop-shadow(0 6px 16px rgba(198,232,1,.35))}
      50%{transform:scale(1.03);filter:drop-shadow(0 10px 26px rgba(198,232,1,.55))}
      100%{transform:scale(1);filter:drop-shadow(0 6px 16px rgba(198,232,1,.35))}
    }

    .zp-result{text-align:center;padding:0 6px;}
    .zp-quiz__result-media{display:grid;grid-template-columns:360px 1fr;gap:18px;align-items:center;margin:18px 0;}
    @media (max-width:760px){.zp-quiz__result-media{grid-template-columns:1fr;}}
    .zp-quiz__result-image{width:100%;aspect-ratio:4/5;border:1px solid var(--zp-border);border-radius:12px;overflow:hidden;background:#fff;display:grid;place-items:center;}
    .zp-quiz__result-image img,.zp-quiz__result-image video{display:block;width:100%;height:100%;object-fit:cover;}
    .zp-quiz__result-image--placeholder{width:100%;height:100%;display:grid;place-items:center;background:linear-gradient(135deg,#f7f9fc,#eef3fb);color:#6a6a6a;font-weight:700;font-size:14px;text-align:center;padding:16px;}
    .zp-quiz__result-image{background:#033a85;position:relative;overflow:hidden}
    .zp-quiz__result-image>*{position:relative;z-index:1}
    .zp-quiz__result-image::after{content:"";position:absolute;inset:0;z-index:0;pointer-events:none;background:linear-gradient(90deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.06) 50%,rgba(255,255,255,0) 100%);transform:translateX(-120%);animation:zpShimmer 1.6s ease-in-out infinite}
    @keyframes zpShimmer{to{transform:translateX(120%)}}

    
    .zp-result__title{font-size:24px;color:var(--zp-navy);margin:6px 0 6px;font-weight:900;}
    .zp-helper{font-size:12px;color:#6a6a6a;margin-top:8px;}

    .zp-result__actions{display:flex;flex-direction:column;gap:10px;margin-top:12px;}
    .zp-result__actions-row{justify-content:center;margin-top:0 !important;}
    .zp-result__actions-row2{display:flex;justify-content:center;width:100%;}
    .zp-result__actions-row2 a{width:100%;max-width:520px;}
    .zp-result__actions-row2 .zp-btn{width:100%;justify-content:center;}

    .zp-error{display:none;margin:12px 20px 0;padding:12px 14px;border:1px solid rgba(220,38,38,.25);background:rgba(220,38,38,.06);color:#991b1b;border-radius:12px;font-weight:700;font-size:14px;}
    .zp-error code{font-weight:800;}
  </style>
</head>

<body>
  <div id="zp-quiz" class="zp-quiz__card">
    <div class="zp-quiz__header">
      <h2 class="zp-quiz__title">Vyhled√°vaƒç padelov√Ωch raket</h2>
      <p class="zp-quiz__subtitle">Najdeme ti ide√°ln√≠ rakety bƒõhem p√°r kliknut√≠.</p>

      <div class="zp-quiz__progress">
        <div class="zp-quiz__progressbar"><span></span></div>
        <div class="zp-quiz__progress-label"><span id="zp-progress-label">Krok 1 z 5</span></div>
      </div>

      <div id="zp-error" class="zp-error"></div>
    </div>

    <div class="zp-quiz__body">
      <section class="zp-step active" data-step="age" aria-label="Vƒõk">
        <h3>Kolik je ti let?</h3>
        <div class="zp-options" role="group" aria-label="Vƒõkov√© rozmez√≠">
          <button class="zp-option" data-value="D√≠tƒõ (6‚Äì15)"><span class="zp-option__label">D√≠tƒõ (6‚Äì15)</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="Dospƒõl√Ω (16‚Äì59)"><span class="zp-option__label">Dospƒõl√Ω (16‚Äì59)</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="Senior (60+)"><span class="zp-option__label">Senior (60+)</span><span class="zp-option__dot"></span></button>
        </div>
        <div class="zp-quiz__nav">
          <button class="zp-btn zp-btn--ghost" data-action="back" disabled>P≈ôedchoz√≠</button>
          <button class="zp-btn zp-btn--primary" data-action="next" disabled>Pokraƒçovat</button>
        </div>
      </section>

      <section class="zp-step" data-step="sex" aria-label="Pohlav√≠">
        <h3>Jak√© je tvoje pohlav√≠?</h3>
        <div class="zp-options" role="group" aria-label="Pohlav√≠">
          <button class="zp-option" data-value="Mu≈æ"><span class="zp-option__label">Mu≈æ</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="≈Ωena"><span class="zp-option__label">≈Ωena</span><span class="zp-option__dot"></span></button>
        </div>
        <div class="zp-quiz__nav">
          <button class="zp-btn zp-btn--ghost" data-action="back">P≈ôedchoz√≠</button>
          <button class="zp-btn zp-btn--primary" data-action="next" disabled>Pokraƒçovat</button>
        </div>
      </section>

      <section class="zp-step" data-step="frequency" aria-label="Frekvence hran√≠">
        <h3>Jak ƒçasto hraje≈°?</h3>
        <div class="zp-options" role="group" aria-label="Frekvence">
          <button class="zp-option" data-value="1‚Äì2√ó mƒõs√≠ƒçnƒõ"><span class="zp-option__label">1‚Äì2√ó mƒõs√≠ƒçnƒõ</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="1√ó t√Ωdnƒõ"><span class="zp-option__label">1√ó t√Ωdnƒõ</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="2‚Äì3√ó t√Ωdnƒõ"><span class="zp-option__label">2‚Äì3√ó t√Ωdnƒõ</span><span class="zp-option__dot"></span></button>
        </div>
        <div class="zp-quiz__nav">
          <button class="zp-btn zp-btn--ghost" data-action="back">P≈ôedchoz√≠</button>
          <button class="zp-btn zp-btn--primary" data-action="next" disabled>Pokraƒçovat</button>
        </div>
      </section>

      <section class="zp-step" data-step="level" aria-label="√örove≈à hr√°ƒçe">
        <h3>Jak√° je tvoje √∫rove≈à?</h3>
        <div class="zp-options" role="group" aria-label="√örove≈à">
          <button class="zp-option" data-value="Zaƒç√°teƒçn√≠k"><span class="zp-option__label">Zaƒç√°teƒçn√≠k</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="Pokroƒçil√Ω"><span class="zp-option__label">Pokroƒçil√Ω</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="Expert"><span class="zp-option__label">Pokroƒçil√Ω a≈æ expert</span><span class="zp-option__dot"></span></button>
        </div>
        <div class="zp-quiz__nav">
          <button class="zp-btn zp-btn--ghost" data-action="back">P≈ôedchoz√≠</button>
          <button class="zp-btn zp-btn--primary" data-action="next" disabled>Pokraƒçovat</button>
        </div>
      </section>

      <section class="zp-step" data-step="style" aria-label="Preferovan√Ω styl">
        <h3>Co preferuje≈°?</h3>
        <div class="zp-options" role="group" aria-label="Preference">
          <button class="zp-option" data-value="Kontrola"><span class="zp-option__label">Kontrolu</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="Univerz√°lnost"><span class="zp-option__label">Univerz√°lnost</span><span class="zp-option__dot"></span></button>
          <button class="zp-option" data-value="S√≠la"><span class="zp-option__label">S√≠lu</span><span class="zp-option__dot"></span></button>
        </div>
        <div class="zp-quiz__nav">
          <button class="zp-btn zp-btn--ghost" data-action="back">P≈ôedchoz√≠</button>
          <button class="zp-btn zp-btn--primary" data-action="finish" disabled>Zobrazit doporuƒçen√≠</button>
        </div>
      </section>

      <section class="zp-step" data-step="result" aria-label="Doporuƒçen√≠" tabindex="-1">
        <div class="zp-result">
          <div class="zp-quiz__result-media">
            <div class="zp-quiz__result-image" id="zp-result-image">
              <div class="zp-quiz__result-image--placeholder">Video v√Ωsledku</div>
            </div>
            <div>
              <span class="zp-helper">Doporuƒçen√≠</span>
              <h3 class="zp-result__title" id="zp-result-title">‚Äî</h3>
              <p class="zp-helper" id="zp-result-subtitle">‚Äî</p>
              <div id="zp-result-desc">‚Äî</div>

              <div class="zp-result__actions">
                <div class="zp-quiz__nav zp-result__actions-row">
                  <button class="zp-btn zp-btn--ghost" data-action="restart">Zaƒç√≠t znovu</button>
                  <span id="zp-result-cta"></span>
                </div>
                <div class="zp-result__actions-row2">
                  <span id="zp-result-cta-tip"></span>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const RULES_URL = './data/zp-filter-rules-videos-tip.json';

      const root = document.getElementById('zp-quiz');
      if (!root) return;

      const errorBox = document.getElementById('zp-error');
      const showError = (msg) => {
        if (!errorBox) return;
        errorBox.style.display = 'block';
        errorBox.innerHTML = msg;
      };

      let RULES = [];

      async function loadRules() {
        const res = await fetch(RULES_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        RULES = Array.isArray(data.rules) ? data.rules : [];
      }

      try { await loadRules(); }
      catch (err) {
        console.error('Chyba naƒç√≠t√°n√≠ pravidel:', err);
        showError('Nepoda≈ôilo se naƒç√≠st pravidla z <code>' + RULES_URL + '</code>. Zkontroluj, ≈æe soubor existuje a je validn√≠ JSON.');
      }

      const steps = Array.from(root.querySelectorAll('.zp-step'));
      const progressBar = root.querySelector('.zp-quiz__progressbar > span');
      const progressLabel = root.querySelector('#zp-progress-label');

      const ORDER = ['age','sex','frequency','level','style','result'];
      const RESULT_INDEX = ORDER.indexOf('result');

      const state = { stepIndex: 0, answers: { age:null, sex:null, frequency:null, level:null, style:null } };

      function setProgress() {
        const totalSteps = ORDER.length - 1;
        const currentStep = Math.min(state.stepIndex + 1, totalSteps);
        const pct = ((currentStep - 1) / (totalSteps - 1)) * 100;
        if (progressBar) progressBar.style.width = pct + '%';
        if (progressLabel) progressLabel.textContent = `Krok ${currentStep} z ${totalSteps}`;
      }
      
      function updateStyleOptions() {
        const styleStep = root.querySelector('.zp-step[data-step="style"]');
        if (!styleStep) return;

        const isBeginner = state.answers.level === 'Zaƒç√°teƒçn√≠k';

        styleStep.querySelectorAll('.zp-option').forEach(opt => {
          const val = opt.getAttribute('data-value');
          if (val === 'S√≠la') {
            opt.style.display = isBeginner ? 'none' : '';
            if (isBeginner) opt.classList.remove('selected');
          }
        });

        if (isBeginner && state.answers.style === 'S√≠la') {
          state.answers.style = null;
          const finishBtn = styleStep.querySelector('[data-action="finish"]');
          if (finishBtn) finishBtn.disabled = true;
        }
      }

      function showStep(index) {
        state.stepIndex = index;
        steps.forEach((s,i) => s.classList.toggle('active', i === index));
        setProgress();

        const active = steps[index];
        const nextBtn = active.querySelector('[data-action="next"], [data-action="finish"]');
        if (nextBtn) {
          const stepKey = active.getAttribute('data-step');
          const val = state.answers[stepKey];
          nextBtn.disabled = !val;
        }
        if (active.getAttribute('data-step') === 'style') {
          updateStyleOptions();
        }
      }

      function handleOptionClick(stepEl, btn) {
        stepEl.querySelectorAll('.zp-option').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');

        const value = btn.getAttribute('data-value');
        const key = stepEl.getAttribute('data-step');
        state.answers[key] = value;

        const advanceBtn = stepEl.querySelector('[data-action="next"], [data-action="finish"]');
        if (advanceBtn) advanceBtn.disabled = false;
        if (key === 'level') {
          updateStyleOptions();
        }
      }

      function findRule(a) {
        if (a.age === 'D√≠tƒõ (6‚Äì15)') {
          return RULES.find(r => r.age === 'D√≠tƒõ (6‚Äì15)') || null;
        }
        return RULES.find(r =>
          (r.age === '*' || !r.age) &&
          (r.frequency === a.frequency) &&
          (r.level === a.level) &&
          (r.style === a.style)
        ) || null;
      }

      function renderResult(rule) {
        const titleEl = root.querySelector('#zp-result-title');
        const subEl = root.querySelector('#zp-result-subtitle');
        const wrap = root.querySelector('#zp-result-image');
        const cta = root.querySelector('#zp-result-cta');
        const ctaTip = root.querySelector('#zp-result-cta-tip');
        const desc = root.querySelector('#zp-result-desc');

        const a = state.answers;
        const safe = rule || { redirectUrl:'https://www.zijpadel.cz/rakety-na-padel/', tipRedirectUrl:'', mediaUrl:'', mediaType:'video', fallbackImageUrl:'' };

        titleEl.textContent = (a.age === 'D√≠tƒõ (6‚Äì15)') ? 'Doporuƒçen√≠ pro dƒõti' : `Doporuƒçen√≠: ${a.style} ‚Ä¢ ${a.level}`;
        subEl.textContent = [a.age, a.sex, a.frequency].filter(Boolean).join(' ‚Ä¢ ');
        desc.textContent = (a.age === 'D√≠tƒõ (6‚Äì15)')
          ? 'Vybrali jsme vhodnou dƒõtskou raketu.'
          : `Podle tv√©ho stylu (${a.style}), √∫rovnƒõ (${a.level}) a frekvence hran√≠ (${a.frequency}) jsme vybrali nejvhodnƒõj≈°√≠ v√Ωbƒõr.`;

        // media (video -> fallback image)
        wrap.innerHTML = '';
        if (safe.mediaType === 'video' && safe.mediaUrl) {
          const v = document.createElement('video');
          v.src = safe.mediaUrl;
          v.autoplay = true;
          v.muted = true;
          v.playsInline = true;
          v.loop = false;
          v.setAttribute('preload','auto');
          if (safe.fallbackImageUrl) v.poster = safe.fallbackImageUrl;

          v.addEventListener('error', () => {
            if (!safe.fallbackImageUrl) return;
            wrap.innerHTML = '';
            const img = document.createElement('img');
            img.src = safe.fallbackImageUrl;
            img.alt = titleEl.textContent || 'V√Ωsledek kv√≠zu';
            wrap.appendChild(img);
          });

          wrap.appendChild(v);
        } else if (safe.fallbackImageUrl) {
          const img = document.createElement('img');
          img.src = safe.fallbackImageUrl;
          img.alt = titleEl.textContent || 'V√Ωsledek kv√≠zu';
          wrap.appendChild(img);
        } else {
          const ph = document.createElement('div');
          ph.className = 'zp-quiz__result-image--placeholder';
          ph.textContent = 'Video/obr√°zek nen√≠ nastaven';
          wrap.appendChild(ph);
        }

        // CTA 1: v≈°echny rakety pro filtr
        cta.innerHTML = '';
        const link = document.createElement('a');
        link.href = safe.redirectUrl || 'https://www.zijpadel.cz/rakety-na-padel/';
        link.target = '_top';
        link.innerHTML = '<button class="zp-btn zp-btn--primary">Zobrazit rakety</button>';
        cta.appendChild(link);

        // CTA 2: TIP (doporuƒçen√©)
        if (ctaTip) {
          ctaTip.innerHTML = '';
          const tipUrl = safe.tipRedirectUrl || '';
          if (tipUrl) {
            const tipLink = document.createElement('a');
            tipLink.href = tipUrl;
            tipLink.target = '_top';
            tipLink.className = 'zp-tip-link';
            tipLink.innerHTML = '<button class="zp-btn zp-btn--primary">Zobrazit na≈°e tipy üí°</button>';
            ctaTip.appendChild(tipLink);
          }
        }
      }

      function next() {
        const currentStepKey = ORDER[state.stepIndex];
        // pokud jsme na kroku "vƒõk" a je zvoleno d√≠tƒõ ‚Üí rovnou v√Ωsledek
        if (currentStepKey === 'age' && state.answers.age === 'D√≠tƒõ (6‚Äì15)') {
          goChildResult();
          return;
        }
        showStep(Math.min(state.stepIndex + 1, RESULT_INDEX));
      }
      function back(){ showStep(Math.max(state.stepIndex - 1, 0)); }

      function finish(){
        const rule = findRule(state.answers);
        if (!rule) showError('Nena≈°li jsme pravidlo pro tuto kombinaci. Zkontroluj <code>' + RULES_URL + '</code>.');
        renderResult(rule);
        showStep(RESULT_INDEX);
      }

      function restart(){
        state.stepIndex = 0;
        state.answers = { age:null, sex:null, frequency:null, level:null, style:null };
        root.querySelectorAll('.zp-option').forEach(b => b.classList.remove('selected'));
        root.querySelectorAll('[data-action="next"], [data-action="finish"]').forEach(btn => btn.disabled = true);
        const firstBack = steps[0].querySelector('[data-action="back"]');
        if (firstBack) firstBack.disabled = true;
        showStep(0);
      }

      function goChildResult() {
        state.answers.sex = null;
        state.answers.frequency = null;
        state.answers.level = null;
        state.answers.style = null;

        const childRule = RULES.find(r => r.age === 'D√≠tƒõ (6‚Äì15)') || null;
        renderResult(childRule);
        showStep(RESULT_INDEX);
      }

      root.querySelectorAll('.zp-step').forEach(stepEl => {
        stepEl.addEventListener('click', (e) => {
          const btn = e.target.closest('.zp-option');
          if (!btn) return;
          handleOptionClick(stepEl, btn);
        });
      });

      root.addEventListener('click', (e) => {
        const actionBtn = e.target.closest('[data-action]');
        if (!actionBtn) return;
        const action = actionBtn.getAttribute('data-action');
        if (action === 'next') next();
        if (action === 'back') back();
        if (action === 'finish') finish();
        if (action === 'restart') restart();
        const firstBack = steps[0].querySelector('[data-action="back"]');
        if (firstBack) firstBack.disabled = (state.stepIndex === 0);
      });

      setProgress();
    });
  </script>

  <script>
  (function () {
    function getHeight() {
      const body = document.body;
      const html = document.documentElement;
      return Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);
    }
    let raf = null;
    function sendHeight() {
      if (raf) cancelAnimationFrame(raf);
      raf = requestAnimationFrame(() => {
        const h = getHeight();
        window.parent.postMessage({ type: 'ZP_IFRAME_HEIGHT', height: h }, '*');
      });
    }
    window.addEventListener('load', sendHeight);
    window.addEventListener('resize', sendHeight);

    const mo = new MutationObserver(sendHeight);
    mo.observe(document.documentElement, { childList: true, subtree: true, attributes: true });

    document.addEventListener('loadedmetadata', (e) => {
      if (e.target && e.target.tagName === 'VIDEO') sendHeight();
    }, true);

    sendHeight();
  })();
  </script>
</body>
</html>
